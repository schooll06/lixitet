<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucky Box T·∫øt 2026</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 500px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .login-screen {
            padding: 40px;
            text-align: center;
        }

        .login-screen.active {
            display: block;
        }

        .login-screen h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #c0392b;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .login-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .main-content {
            display: none;
            padding: 40px;
        }

        .main-content.active {
            display: block;
        }

        .user-info {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .user-name {
            font-size: 1.2em;
            color: #2c3e50;
            font-weight: bold;
        }

        .user-role {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .user-role.admin {
            background: #e74c3c;
            color: white;
        }

        .wish-section {
            margin-bottom: 30px;
        }

        .wish-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .wish-input {
            width: 100%;
            min-height: 120px;
            padding: 15px;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            margin-bottom: 10px;
        }

        .char-count {
            text-align: right;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .char-count.warning {
            color: #e74c3c;
        }

        .char-count.success {
            color: #27ae60;
        }

        .submit-btn {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }

        .submit-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .wish-preview {
            display: none;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .wish-preview.active {
            display: block;
        }

        .wish-preview h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .wish-preview p {
            color: #34495e;
            font-style: italic;
            line-height: 1.6;
        }

        .lucky-boxes {
            display: none;
            margin-bottom: 30px;
        }

        .lucky-boxes.active {
            display: block;
        }

        .lucky-boxes h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.3em;
        }

        .boxes-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .box {
            width: 120px;
            height: 120px;
            perspective: 1000px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .box:hover {
            transform: scale(1.05);
        }

        .box.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .box-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }

        .box.flipped .box-inner {
            transform: rotateY(180deg);
        }

        .box-front, .box-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .box-front {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .box-front i {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .box-number {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .box-label {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .box-back {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            transform: rotateY(180deg);
        }

        .prize-amount {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .prize-label {
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .camera-button {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .camera-button:hover {
            transform: scale(1.05);
        }

        .prize-info {
            display: none;
            margin-bottom: 30px;
        }

        .prize-info.active {
            display: block;
        }

        .prize-info h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
        }

        .info-card {
            background: white;
            border: 2px solid #e74c3c;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .info-card h3 {
            color: #e74c3c;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .info-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .info-section h4 {
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 1.1em;
        }

        .info-section p {
            font-size: 1.2em;
            font-weight: bold;
            color: #e74c3c;
            margin: 5px 0;
        }

        .message {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .firework {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            border-radius: 50%;
        }

        .admin-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            padding: 15px;
            min-width: 250px;
            z-index: 1000;
        }

        .admin-toggle {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .admin-content {
            display: none;
            margin-top: 15px;
        }

        .admin-content.active {
            display: block;
        }

        .admin-content h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .admin-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .admin-stat strong {
            color: #e74c3c;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                max-width: 100%;
            }

            .header h1 {
                font-size: 2em;
            }

            .box {
                width: 100px;
                height: 100px;
            }

            .admin-panel {
                top: 10px;
                right: 10px;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üßß LUCKY BOX T·∫æT üßß</h1>
            <p>Ch√†o m·ª´ng nƒÉm m·ªõi! G·ª≠i l·ªùi ch√∫c T·∫øt √Ω nghƒ©a ƒë·ªÉ m·ªü h·ªôp may m·∫Øn v√† nh·∫≠n l√¨ x√¨!</p>
        </header>

        <div class="login-screen active" id="loginScreen">
            <h2>üéä ƒêƒÉng Nh·∫≠p Tham Gia üéä</h2>
            <input type="text" id="userName" class="login-input" placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n" maxlength="50">
            <button class="login-btn" onclick="loginUser()">
                <i class="fas fa-sign-in-alt"></i> Tham Gia Ngay
            </button>
            <button class="login-btn" onclick="clearCache()" style="background: #e74c3c; margin-top: 10px;">
                <i class="fas fa-trash"></i> X√≥a Cache (Test)
            </button>
        </div>

        <div class="main-content" id="mainContent">
            <div class="user-info">
                <div class="user-name" id="currentUserName"></div>
                <div class="user-role" id="userRole"></div>
            </div>

            <div class="wish-section">
                <h3>üìù L·ªùi Ch√∫c T·∫øt C·ªßa B·∫°n</h3>
                <textarea id="wishInput" class="wish-input" placeholder="H√£y vi·∫øt l·ªùi ch√∫c T·∫øt th·∫≠t √Ω nghƒ©a (√≠t nh·∫•t 20 k√Ω t·ª±)..." maxlength="500"></textarea>
                <div id="charCount" class="char-count">0/20 k√Ω t·ª±</div>
                <button id="submitWish" class="submit-btn" disabled>
                    <i class="fas fa-paper-plane"></i> G·ª≠i L·ªùi Ch√∫c
                </button>
            </div>

            <div class="wish-preview" id="wishPreview">
                <h4>üíù L·ªùi Ch√∫c C·ªßa B·∫°n:</h4>
                <p id="wishText"></p>
            </div>

            <div class="lucky-boxes" id="luckyBoxes">
                <h3>üéÅ Ch·ªçn M·ªôt H·ªôp May M·∫Øn üéÅ</h3>
                <div class="boxes-container" id="boxesContainer">
                    <!-- C√°c h·ªôp s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
            </div>

            <div class="prize-info" id="prizeInfo">
                <h2>üì∏ Ch·ª•p M√†n H√¨nh G·ª≠i Cho Admin</h2>
                <div class="info-card" id="infoCard">
                    <!-- Th√¥ng tin s·∫Ω ƒë∆∞·ª£c t·∫°o b·∫±ng JavaScript -->
                </div>
            </div>

            <div class="message" id="message"></div>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel" style="display: none;">
        <button class="admin-toggle" id="adminToggle">
            <i class="fas fa-cog"></i> Admin Panel
        </button>
        <div class="admin-content" id="adminContent">
            <h4>üìä Th·ªëng K√™</h4>
            <div class="admin-stat">
                <span>T·ªïng ng∆∞·ªùi d√πng:</span>
                <strong id="totalUsers">0</strong>
            </div>
            <div class="admin-stat">
                <span>T·ªïng l·ªùi ch√∫c:</span>
                <strong id="totalWishes">0</strong>
            </div>
            <div class="admin-stat">
                <span>H·ªôp ƒë√£ m·ªü:</span>
                <strong id="boxesOpened">0</strong>
            </div>
            <div class="admin-stat">
                <span>T·ªïng ti·ªÅn:</span>
                <strong id="totalMoney">0 VND</strong>
            </div>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu c√°c bao l√¨ x√¨
        const prizes = [
            { amount: "20.000", label: "Hai m∆∞∆°i ngh√¨n ƒë·ªìng", value: 20000 },
            { amount: "50.000", label: "NƒÉm m∆∞∆°i ngh√¨n ƒë·ªìng", value: 50000 },
            { amount: "30.000", label: "Ba m∆∞∆°i ngh√¨n ƒë·ªìng", value: 30000 },
            { amount: "40.000", label: "B·ªën m∆∞∆°i ngh√¨n ƒë·ªìng", value: 40000 },

        ];

        // M√†u s·∫Øc cho c√°c h·ªôp
        const boxColors = ["#FF6B6B", "#4ECDC4", "#FFD166", "#9B59B6", "#3498DB"];

        // T√™n admin
        const ADMIN_NAMES = ["Tr·∫ßn VƒÉn Tr∆∞·ªùng", "Tr·∫ßn VƒÉn Tr∆∞·ªùng", "VƒÉn Tr∆∞·ªùng", "Tr∆∞·ªùng Tr·∫ßn"];

        // Tr·∫°ng th√°i ·ª©ng d·ª•ng
        let selectedBox = null;
        let hasOpenedBox = false;
        let openedBoxIndex = null;
        let currentUser = null;
        let userIP = null;
        let userWish = "";
        let wishSubmitted = false;
        let isAdmin = false;
        let randomizedPrizes = [];

        // D·ªØ li·ªáu l∆∞u tr·ªØ
        let allUsers = [];
        let allWishes = [];
        let participatedUsers = [];

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const mainContent = document.getElementById('mainContent');
        const currentUserName = document.getElementById('currentUserName');
        const userRole = document.getElementById('userRole');
        const wishInput = document.getElementById('wishInput');
        const charCount = document.getElementById('charCount');
        const submitWishBtn = document.getElementById('submitWish');
        const wishPreview = document.getElementById('wishPreview');
        const wishText = document.getElementById('wishText');
        const luckyBoxes = document.getElementById('luckyBoxes');
        const boxesContainer = document.getElementById('boxesContainer');
        const prizeInfo = document.getElementById('prizeInfo');
        const infoCard = document.getElementById('infoCard');
        const message = document.getElementById('message');
        const adminPanel = document.getElementById('adminPanel');
        const adminToggle = document.getElementById('adminToggle');
        const adminContent = document.getElementById('adminContent');

        // H√†m l·∫•y IP (gi·∫£ l·∫≠p)
        function getUserIP() {
            const savedIP = localStorage.getItem('userIP');
            if (savedIP) return savedIP;
            
            const fakeIP = `192.168.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`;
            localStorage.setItem('userIP', fakeIP);
            return fakeIP;
        }

        // Random v·ªã tr√≠ c√°c bao l√¨ x√¨
        function randomizePrizes() {
            randomizedPrizes = [...prizes];
            
            // Tr·ªôn ng·∫´u nhi√™n
            for (let i = randomizedPrizes.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [randomizedPrizes[i], randomizedPrizes[j]] = [randomizedPrizes[j], randomizedPrizes[i]];
            }
        }

        // Ki·ªÉm tra xem user ƒë√£ tham gia ch∆∞a (theo IP)
        function checkIfUserAlreadyParticipated() {
            userIP = getUserIP();
            return participatedUsers.find(user => user.ip === userIP);
        }

        // Ki·ªÉm tra t√™n admin
        function checkIfAdmin(userName) {
            const normalizedUserName = userName.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            
            return ADMIN_NAMES.some(adminName => {
                const normalizedAdminName = adminName.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                return normalizedUserName.includes(normalizedAdminName) || 
                       normalizedAdminName.includes(normalizedUserName);
            });
        }

        // X√≥a cache ƒë·ªÉ test l·∫°i
        function clearCache() {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô d·ªØ li·ªáu v√† b·∫Øt ƒë·∫ßu l·∫°i kh√¥ng?")) {
                localStorage.removeItem('tetLuckyBox_users');
                localStorage.removeItem('tetLuckyBox_wishes');
                localStorage.removeItem('participatedUsers');
                localStorage.removeItem('userIP');
                location.reload();
            }
        }

        // Kh·ªüi t·∫°o trang web
        function initializeApp() {
            // Load d·ªØ li·ªáu t·ª´ localStorage tr∆∞·ªõc
            allUsers = JSON.parse(localStorage.getItem('tetLuckyBox_users')) || [];
            allWishes = JSON.parse(localStorage.getItem('tetLuckyBox_wishes')) || [];
            participatedUsers = JSON.parse(localStorage.getItem('participatedUsers')) || [];
            
            userIP = getUserIP();
            const existingUser = checkIfUserAlreadyParticipated();
            
            console.log("üîç Check existing user:", existingUser);
            console.log("üë• Total participated:", participatedUsers.length);
            
            if (existingUser) {
                showAlreadyParticipatedScreen(existingUser);
            } else {
                loginScreen.classList.add('active');
            }
            
            randomizePrizes();
            
            // S·ª± ki·ªán cho admin toggle
            adminToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                adminContent.classList.toggle('active');
            });
            
            // ƒê√≥ng admin panel khi click ra ngo√†i
            document.addEventListener('click', function() {
                adminContent.classList.remove('active');
            });
        }

        // Hi·ªÉn th·ªã m√†n h√¨nh ƒë√£ tham gia
        function showAlreadyParticipatedScreen(userData) {
            loginScreen.classList.remove('active');
            mainContent.classList.add('active');
            currentUserName.textContent = userData.name;
            
            // Hi·ªÉn th·ªã th√¥ng b√°o ƒë√£ tham gia
            message.innerHTML = `<i class="fas fa-check-circle"></i> B·∫°n ƒë√£ tham gia v√† nh·∫≠n ƒë∆∞·ª£c <strong>${userData.prize}</strong>. M·ªói ng∆∞·ªùi ch·ªâ ƒë∆∞·ª£c tham gia 1 l·∫ßn!`;
            message.style.color = "#27ae60";
            message.style.background = "#d4edda";
            message.style.padding = "15px";
            message.style.borderRadius = "10px";
        }

        // ƒêƒÉng nh·∫≠p user
        function loginUser() {
            const userName = document.getElementById('userName').value.trim();
            
            if (!userName) {
                alert("Vui l√≤ng nh·∫≠p h·ªç v√† t√™n!");
                return;
            }
            
            // Ki·ªÉm tra n·∫øu l√† admin
            if (checkIfAdmin(userName)) {
                isAdmin = true;
                adminPanel.style.display = 'block';
                userRole.textContent = "ADMIN";
                userRole.classList.add('admin');
            }
            
            // L∆∞u user
            currentUser = {
                name: userName,
                ip: userIP,
                time: new Date().toISOString(),
                isAdmin: isAdmin
            };
            
            allUsers.push(currentUser);
            localStorage.setItem('tetLuckyBox_users', JSON.stringify(allUsers));
            
            // Chuy·ªÉn ƒë·∫øn m√†n h√¨nh ch√≠nh
            loginScreen.classList.remove('active');
            mainContent.classList.add('active');
            currentUserName.textContent = userName;
            
            // Theo d√µi s·ªë k√Ω t·ª± l·ªùi ch√∫c
            wishInput.addEventListener('input', function() {
                const length = this.value.length;
                charCount.textContent = `${length}/20 k√Ω t·ª±`;
                
                if (length < 20) {
                    charCount.className = 'char-count warning';
                    submitWishBtn.disabled = true;
                } else {
                    charCount.className = 'char-count success';
                    submitWishBtn.disabled = false;
                }
            });
            
            // C·∫≠p nh·∫≠t admin panel n·∫øu l√† admin
            if (isAdmin) {
                updateAdminPanel();
            }
        }

        // X·ª≠ l√Ω g·ª≠i l·ªùi ch√∫c
        function submitWish() {
            userWish = wishInput.value.trim();
            
            if (userWish.length < 20) {
                message.textContent = "L·ªùi ch√∫c ph·∫£i c√≥ √≠t nh·∫•t 20 k√Ω t·ª±!";
                message.style.color = "#e74c3c";
                return;
            }
            
            wishSubmitted = true;
            
            // L∆∞u l·ªùi ch√∫c
            const wishData = {
                userName: currentUser.name,
                userIP: userIP,
                wish: userWish,
                time: new Date().toISOString()
            };
            
            allWishes.push(wishData);
            localStorage.setItem('tetLuckyBox_wishes', JSON.stringify(allWishes));
            
            // Hi·ªÉn th·ªã l·ªùi ch√∫c
            wishText.textContent = userWish;
            wishPreview.classList.add('active');
            
            // V√¥ hi·ªáu h√≥a ph·∫ßn nh·∫≠p l·ªùi ch√∫c
            wishInput.disabled = true;
            submitWishBtn.disabled = true;
            submitWishBtn.innerHTML = '<i class="fas fa-check"></i> ƒê√£ g·ª≠i l·ªùi ch√∫c';
            
            // Hi·ªÉn th·ªã c√°c h·ªôp may m·∫Øn
            luckyBoxes.classList.add('active');
            message.textContent = "L·ªùi ch√∫c c·ªßa b·∫°n th·∫≠t √Ω nghƒ©a! B√¢y gi·ªù h√£y ch·ªçn M·ªòT h·ªôp may m·∫Øn ƒë·ªÉ m·ªü.";
            message.style.color = "#27ae60";
            
            // Kh·ªüi t·∫°o c√°c h·ªôp v·ªõi v·ªã tr√≠ random
            initializeBoxes();
            
            // C·∫≠p nh·∫≠t admin panel n·∫øu l√† admin
            if (isAdmin) {
                updateAdminPanel();
            }
        }

        // G√°n h√†m submitWish cho button
        document.getElementById('submitWish').onclick = submitWish;

        // Kh·ªüi t·∫°o c√°c h·ªôp v·ªõi prizes ƒë√£ random
        function initializeBoxes() {
            boxesContainer.innerHTML = '';
            
            randomizedPrizes.forEach((prize, index) => {
                const boxElement = document.createElement('div');
                boxElement.className = 'box';
                boxElement.id = `box-${index}`;
                
                boxElement.innerHTML = `
                    <div class="box-inner">
                        <div class="box-front">
                            <i class="fas fa-gift"></i>
                            <div class="box-number">${index + 1}</div>
                            <div class="box-label">H·ªôp may m·∫Øn</div>
                        </div>
                        <div class="box-back" style="background: linear-gradient(145deg, ${boxColors[index]}, ${darkenColor(boxColors[index], 20)});">
                            <div class="prize-amount">${prize.amount} VND</div>
                            <div class="prize-label">${prize.label}</div>
                            <button class="camera-button" onclick="showPrizeInfo(${index})">
                                <i class="fas fa-camera"></i> Ch·ª•p m√†n h√¨nh
                            </button>
                        </div>
                    </div>
                `;
                
                boxElement.addEventListener('click', () => openBox(index));
                boxesContainer.appendChild(boxElement);
            });
        }

        // M·ªü h·ªôp
        function openBox(index) {
            if (!wishSubmitted) {
                message.textContent = "Vui l√≤ng g·ª≠i l·ªùi ch√∫c tr∆∞·ªõc khi m·ªü h·ªôp!";
                message.style.color = "#e74c3c";
                return;
            }
            
            if (hasOpenedBox) {
                message.textContent = "B·∫°n ƒë√£ m·ªü h·ªôp r·ªìi! M·ªói ng∆∞·ªùi ch·ªâ ƒë∆∞·ª£c m·ªü M·ªòT h·ªôp.";
                message.style.color = "#e74c3c";
                return;
            }
            
            const boxElement = document.getElementById(`box-${index}`);
            boxElement.classList.add('flipped');
            
            // L∆∞u th√¥ng tin user ƒë√£ m·ªü h·ªôp
            const selectedPrize = randomizedPrizes[index];
            currentUser.prize = selectedPrize.amount + " VND";
            currentUser.prizeValue = selectedPrize.value;
            currentUser.boxOpenedTime = new Date().toISOString();
            
            // L∆∞u v√†o danh s√°ch ƒë√£ tham gia
            participatedUsers.push({
                ip: userIP,
                name: currentUser.name,
                prize: currentUser.prize,
                time: currentUser.boxOpenedTime
            });
            localStorage.setItem('participatedUsers', JSON.stringify(participatedUsers));
            
            // C·∫≠p nh·∫≠t tr·∫°ng th√°i
            hasOpenedBox = true;
            openedBoxIndex = index;
            selectedBox = selectedPrize;
            
            // Hi·ªÉn th·ªã th√¥ng b√°o
            message.innerHTML = `<i class="fas fa-gift"></i> Ch√∫c m·ª´ng! B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c <strong>${selectedPrize.label}</strong>. Nh·∫•n n√∫t "Ch·ª•p m√†n h√¨nh" ƒë·ªÉ nh·∫≠n ti·ªÅn.`;
            message.style.color = "#27ae60";
            
            // T·∫°o hi·ªáu ·ª©ng ph√°o hoa
            createFireworks();
            
            // V√¥ hi·ªáu h√≥a c√°c h·ªôp kh√°c
            for (let i = 0; i < randomizedPrizes.length; i++) {
                if (i !== index) {
                    const otherBox = document.getElementById(`box-${i}`);
                    otherBox.classList.add('disabled');
                    otherBox.replaceWith(otherBox.cloneNode(true));
                }
            }
            
            // C·∫≠p nh·∫≠t admin panel n·∫øu l√† admin
            if (isAdmin) {
                updateAdminPanel();
            }
        }

        // Hi·ªÉn th·ªã th√¥ng tin ƒë·ªÉ ch·ª•p m√†n h√¨nh
        function showPrizeInfo(index) {
            if (!wishSubmitted) {
                alert("Vui l√≤ng g·ª≠i l·ªùi ch√∫c tr∆∞·ªõc khi xem th√¥ng tin!");
                return;
            }
            
            if (openedBoxIndex !== index) {
                alert("B·∫°n ch∆∞a m·ªü h·ªôp n√†y! Vui l√≤ng m·ªü h·ªôp tr∆∞·ªõc khi xem th√¥ng tin.");
                return;
            }
            
            // T·∫°o n·ªôi dung th√¥ng tin r√µ r√†ng ƒë·ªÉ ch·ª•p m√†n h√¨nh
            const infoContent = `
                <h3>üßß L·ªúI CH√öC T·∫æT 2026 üßß</h3>
                
                <div class="info-section">
                    <h4>üë§ Ng∆∞·ªùi nh·∫≠n:</h4>
                    <p>${currentUser.name}</p>
                </div>
                
                <div class="info-section">
                    <h4>üí∞ S·ªë ti·ªÅn nh·∫≠n:</h4>
                    <p>${randomizedPrizes[index].amount} VND</p>
                </div>
                
                                
                <div class="info-section">
                    <h4>‚è∞ H·∫°n s·ª≠ d·ª•ng:</h4>
                    <p>24 gi·ªù</p>
                </div>
                
                <div style="margin-top: 20px; padding-top: 15px; border-top: 2px solid #e74c3c;">
                    <p style="font-size: 14px; color: #6c757d;">üì± Vui l√≤ng ch·ª•p m√†n h√¨nh n√†y</p>
                    <p style="font-size: 14px; color: #6c757d;">üî• G·ª≠i cho Admin: Tr·∫ßn VƒÉn Tr∆∞·ªùng</p>
                </div>
            `;
            
            infoCard.innerHTML = infoContent;
            
            // Hi·ªÉn th·ªã section th√¥ng tin
            prizeInfo.classList.add('active');
            prizeInfo.scrollIntoView({ behavior: 'smooth' });
            
            // Th√¥ng b√°o cho ng∆∞·ªùi d√πng
            setTimeout(() => {
                alert("üì∏ Vui l√≤ng ch·ª•p m√†n h√¨nh th√¥ng tin n√†y v√† g·ª≠i cho Admin Tr·∫ßn VƒÉn Tr∆∞·ªùng ƒë·ªÉ nh·∫≠n ti·ªÅn!");
            }, 500);
        }

        // C·∫≠p nh·∫≠t admin panel
        function updateAdminPanel() {
            const totalUsers = allUsers.length;
            const totalWishes = allWishes.length;
            const boxesOpened = participatedUsers.length;
            
            let totalMoney = 0;
            participatedUsers.forEach(user => {
                if (user.prize) {
                    const amount = parseInt(user.prize.replace(/[^0-9]/g, ''));
                    if (!isNaN(amount)) {
                        totalMoney += amount;
                    }
                }
            });
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalWishes').textContent = totalWishes;
            document.getElementById('boxesOpened').textContent = boxesOpened;
            document.getElementById('totalMoney').textContent = totalMoney.toLocaleString('vi-VN') + ' VND';
        }

        // T·∫°o hi·ªáu ·ª©ng ph√°o hoa
        function createFireworks() {
            const colors = ['#e74c3c', '#f1c40f', '#2ecc71', '#3498db', '#9b59b6'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    
                    const x = Math.random() * window.innerWidth;
                    const y = Math.random() * window.innerHeight;
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    const size = Math.random() * 10 + 5;
                    
                    firework.style.left = `${x}px`;
                    firework.style.top = `${y}px`;
                    firework.style.width = `${size}px`;
                    firework.style.height = `${size}px`;
                    firework.style.backgroundColor = color;
                    firework.style.boxShadow = `0 0 10px ${color}`;
                    
                    document.body.appendChild(firework);
                    
                    setTimeout(() => {
                        firework.remove();
                    }, 1000);
                }, i * 50);
            }
        }

        // H√†m l√†m t·ªëi m√†u
        function darkenColor(color, percent) {
            const num = parseInt(color.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            
            return "#" + (
                0x1000000 +
                (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
                (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
                (B < 255 ? (B < 1 ? 0 : B) : 255)
            ).toString(16).slice(1);
        }

        // Kh·ªüi t·∫°o trang web khi load
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
